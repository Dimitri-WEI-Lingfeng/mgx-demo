# CLI UI Enhancement - Agent Stream Events ç¾åŒ–è¾“å‡º

**æ—¥æœŸ**: 2026-02-01  
**ç±»å‹**: Feature  
**å½±å“èŒƒå›´**: Agent æœ¬åœ°è¿è¡Œã€CLI äº¤äº’

## æ¦‚è¿°

æ·»åŠ äº†ä¸€ä¸ªä¸“é—¨çš„ CLI Agent UI æ¨¡å—æ¥ç¾åŒ–æ‰“å° agent å‘å‡ºçš„ stream eventsï¼Œå¤§å¹…æå‡äº†å‘½ä»¤è¡Œç•Œé¢çš„ç”¨æˆ·ä½“éªŒã€‚

## å˜æ›´å†…å®¹

### æ–°å¢æ–‡ä»¶

1. **`src/agents/cli_ui.py`** - CLI UI æ ¸å¿ƒæ¨¡å—
   - `AgentStreamUI`: å®Œæ•´çš„ Rich UI å®ç°
   - `SimpleStreamUI`: ç®€åŒ–ç‰ˆ UI
   - æ”¯æŒå¤šç§äº‹ä»¶ç±»å‹çš„ç¾åŒ–å±•ç¤º
   - ç»Ÿè®¡ä¿¡æ¯å’Œæ‘˜è¦åŠŸèƒ½

2. **`src/agents/demo_cli_ui.py`** - UI åŠŸèƒ½æ¼”ç¤ºè„šæœ¬
   - å±•ç¤ºæ‰€æœ‰äº‹ä»¶ç±»å‹çš„æ˜¾ç¤ºæ•ˆæœ
   - æ¼”ç¤ºå·¥ä½œæµç¨‹å’Œé˜¶æ®µå˜æ›´
   - é”™è¯¯å¤„ç†æ¼”ç¤º

3. **`src/agents/CLI_UI_README.md`** - ä½¿ç”¨æ–‡æ¡£
   - è¯¦ç»†çš„åŠŸèƒ½è¯´æ˜
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
   - æ•…éšœæ’é™¤æŒ‡å—

### ä¿®æ”¹æ–‡ä»¶

1. **`src/agents/run_agent_local.py`**
   - é›†æˆ CLI UI
   - æ–°å¢ `--ui` å‚æ•°ï¼ˆrich/simple/noneï¼‰
   - æ–°å¢ `--verbose` å‚æ•°
   - æ›´æ–° `run_local_agent` å‡½æ•°ç­¾å

2. **`pyproject.toml`**
   - æ·»åŠ  `rich>=13.0.0` ä¾èµ–

## åŠŸèƒ½ç‰¹æ€§

### 1. ç¾åŒ–çš„äº‹ä»¶å±•ç¤º

- ğŸ¨ **å½©è‰²è¾“å‡º**: ä½¿ç”¨ rich åº“æä¾›çš„å½©è‰²ç»ˆç«¯è¾“å‡º
- ğŸ“Š **è¡¨æ ¼å’Œé¢æ¿**: ç»“æ„åŒ–å±•ç¤ºä¿¡æ¯
- ğŸ­ **Emoji å›¾æ ‡**: ä¸ºä¸åŒäº‹ä»¶ç±»å‹å’Œ Agent è§’è‰²åˆ†é…ä¸“å± emoji
- â±ï¸ **æ—¶é—´æˆ³**: å¯é€‰çš„æ—¶é—´æˆ³æ˜¾ç¤º

### 2. æ”¯æŒçš„äº‹ä»¶ç±»å‹

#### Agent ç”Ÿå‘½å‘¨æœŸ
- `agent_start` â–¶ï¸ - Agent å¼€å§‹å·¥ä½œ
- `agent_end` âœ… - Agent å®Œæˆå·¥ä½œ  
- `agent_error` âŒ - Agent æ‰§è¡Œé”™è¯¯

#### å·¥å…·è°ƒç”¨
- `tool_start` ğŸ”§ - å·¥å…·è°ƒç”¨å¼€å§‹
- `tool_end` âœ”ï¸ - å·¥å…·è°ƒç”¨å®Œæˆ

#### LLM äº‹ä»¶
- `llm_start` ğŸ¤– - LLM å¼€å§‹ç”Ÿæˆ
- `llm_stream` ğŸ’¬ - LLM æµå¼è¾“å‡º
- `llm_end` âœ“ - LLM ç”Ÿæˆå®Œæˆ

#### æ¶ˆæ¯äº‹ä»¶
- `message_delta` ğŸ“ - å¢é‡æ¶ˆæ¯
- `message_complete` ğŸ“„ - å®Œæ•´æ¶ˆæ¯

### 3. Agent è§’è‰²è¯†åˆ«

æ”¯æŒä»¥ä¸‹ Agent è§’è‰²çš„ç‰¹æ®Šå±•ç¤ºï¼š
- ğŸ‘” Boss - éœ€æ±‚æç‚¼
- ğŸ“‹ Product Manager - PRD ç¼–å†™
- ğŸ—ï¸ Architect - æŠ€æœ¯è®¾è®¡
- ğŸ“Š Project Manager - ä»»åŠ¡æ‹†è§£
- ğŸ’» Engineer - ä»£ç å®ç°
- ğŸ§ª QA - æµ‹è¯•éªŒè¯

### 4. ç»Ÿè®¡å’Œæ‘˜è¦

- Agent æ´»åŠ¨ç»Ÿè®¡ï¼ˆæ‰§è¡Œæ¬¡æ•°ã€å·¥å…·è°ƒç”¨ï¼‰
- å·¥å…·è°ƒç”¨ç»Ÿè®¡ï¼ˆæŒ‰è°ƒç”¨æ¬¡æ•°æ’åºï¼‰
- äº‹ä»¶æ€»æ•°ç»Ÿè®¡
- å·¥ä½œæµç¨‹æ‘˜è¦ï¼ˆæ–‡æ¡£ã€ä»»åŠ¡ã€æµ‹è¯•ç»“æœç­‰ï¼‰

### 5. ä¸‰ç§ UI æ¨¡å¼

- **Rich UI** (é»˜è®¤): å®Œæ•´çš„ç¾åŒ–è¾“å‡ºï¼Œæœ€ä½³ç”¨æˆ·ä½“éªŒ
- **Simple UI**: è½»é‡çº§çš„ç®€å•è¾“å‡ºï¼Œé€‚åˆè°ƒè¯•
- **None**: åŸå§‹è¾“å‡ºï¼Œé€‚åˆæ—¥å¿—è®°å½•

## ä½¿ç”¨æ–¹æ³•

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# é»˜è®¤ä½¿ç”¨ Rich UI
uv run src/agents/run_agent_local.py --prompt "åˆ›å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿ"

# ä½¿ç”¨ Simple UI
uv run src/agents/run_agent_local.py --prompt "åˆ›å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿ" --ui simple

# è¯¦ç»†æ¨¡å¼ï¼ˆæ˜¾ç¤ºå·¥å…·å‚æ•°ç­‰ï¼‰
uv run src/agents/run_agent_local.py --prompt "åˆ›å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿ" --verbose

# ä¸ä½¿ç”¨ UI
uv run src/agents/run_agent_local.py --prompt "åˆ›å»ºä¸€ä¸ªåšå®¢ç³»ç»Ÿ" --ui none
```

### ä»£ç ä½¿ç”¨

```python
from agents.cli_ui import AgentStreamUI

# åˆ›å»º UI
ui = AgentStreamUI(show_timestamps=True, verbose=False)

# æ‰“å°å¤´éƒ¨
ui.print_header("ğŸš€ Agent è¿è¡Œ", "ä½¿ç”¨å†…å­˜æ¨¡å¼")

# æ‰“å°ä¿¡æ¯è¡¨æ ¼
ui.print_info_table({
    "Session": "sess_123",
    "Workspace": "/path/to/workspace",
})

# å¤„ç†äº‹ä»¶
for event in event_stream:
    ui.print_event(event)

# æ‰“å°æ‘˜è¦
ui.print_summary(result)
```

### æ¼”ç¤ºè„šæœ¬

```bash
# è¿è¡Œæ¼”ç¤ºæŸ¥çœ‹æ‰€æœ‰åŠŸèƒ½
uv run src/agents/demo_cli_ui.py
```

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒä¾èµ–

- **rich**: Python ç»ˆç«¯ç¾åŒ–åº“
  - æä¾›å½©è‰²è¾“å‡ºã€è¡¨æ ¼ã€é¢æ¿ã€è¿›åº¦æ¡ç­‰åŠŸèƒ½
  - æ”¯æŒ Unicode å’Œ emoji
  - è‡ªåŠ¨å¤„ç†ç»ˆç«¯å…¼å®¹æ€§

### æ¶æ„è®¾è®¡

```
AgentStreamUI
â”œâ”€â”€ print_header()          # æ‰“å°æ ‡é¢˜å¤´
â”œâ”€â”€ print_info_table()      # æ‰“å°ä¿¡æ¯è¡¨æ ¼
â”œâ”€â”€ print_event()           # æ‰“å°å•ä¸ªäº‹ä»¶ï¼ˆåˆ†å‘ï¼‰
â”œâ”€â”€ print_stage_change()    # æ‰“å°é˜¶æ®µå˜æ›´
â”œâ”€â”€ print_summary()         # æ‰“å°æ‰§è¡Œæ‘˜è¦
â””â”€â”€ print_error()           # æ‰“å°é”™è¯¯ä¿¡æ¯

äº‹ä»¶å¤„ç†å™¨ï¼ˆç§æœ‰æ–¹æ³•ï¼‰:
â”œâ”€â”€ _handle_agent_start()
â”œâ”€â”€ _handle_agent_end()
â”œâ”€â”€ _handle_tool_start()
â”œâ”€â”€ _handle_tool_end()
â”œâ”€â”€ _handle_llm_stream()
â”œâ”€â”€ _handle_message_delta()
â””â”€â”€ _handle_message_complete()
```

### è®¾è®¡å†³ç­–

1. **åˆ†ç¦»å±•ç¤ºé€»è¾‘**: UI é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘å®Œå…¨åˆ†ç¦»
2. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„äº‹ä»¶ç±»å‹å’Œ Agent è§’è‰²
3. **å¤šæ¨¡å¼æ”¯æŒ**: æä¾›ä¸åŒåœºæ™¯ä¸‹çš„æœ€ä½³ä½“éªŒ
4. **ç»Ÿè®¡åŠŸèƒ½**: è‡ªåŠ¨æ”¶é›†å’Œå±•ç¤ºç»Ÿè®¡ä¿¡æ¯
5. **é”™è¯¯å¤„ç†**: å‹å¥½çš„é”™è¯¯å±•ç¤º

## ä¼˜åŠ¿

1. **ç”¨æˆ·ä½“éªŒ**: å¤§å¹…æå‡å‘½ä»¤è¡Œç•Œé¢çš„å¯è¯»æ€§å’Œç¾è§‚åº¦
2. **è°ƒè¯•å‹å¥½**: æ¸…æ™°å±•ç¤º Agent å·¥ä½œæµç¨‹å’Œäº‹ä»¶æµ
3. **çµæ´»æ€§**: ä¸‰ç§æ¨¡å¼é€‚é…ä¸åŒä½¿ç”¨åœºæ™¯
4. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
5. **é›¶ä¾µå…¥**: ä¸å½±å“ç°æœ‰ä»£ç é€»è¾‘

## åç»­æ”¹è¿›

### çŸ­æœŸæ”¹è¿›

1. **å®æ—¶è¿›åº¦æ¡**: ä¸ºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ·»åŠ è¿›åº¦æ¡
2. **æ—¥å¿—å¯¼å‡º**: æ”¯æŒå¯¼å‡ºç¾åŒ–åçš„æ—¥å¿—åˆ°æ–‡ä»¶
3. **ä¸»é¢˜å®šåˆ¶**: æ”¯æŒè‡ªå®šä¹‰é¢œè‰²ä¸»é¢˜
4. **è¿‡æ»¤åŠŸèƒ½**: æ”¯æŒæŒ‰äº‹ä»¶ç±»å‹è¿‡æ»¤æ˜¾ç¤º

### é•¿æœŸæ”¹è¿›

1. **Web UI**: åŸºäº WebSocket çš„å®æ—¶ Web ç•Œé¢
2. **TUI**: åŸºäº textual çš„äº¤äº’å¼ç»ˆç«¯ç•Œé¢
3. **å¯è§†åŒ–**: æ·»åŠ  ASCII å›¾è¡¨å±•ç¤ºç»Ÿè®¡ä¿¡æ¯
4. **å½•åˆ¶å›æ”¾**: æ”¯æŒå½•åˆ¶å’Œå›æ”¾ agent æ‰§è¡Œè¿‡ç¨‹

## æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•

```bash
# è¿è¡Œæ¼”ç¤ºè„šæœ¬
uv run src/agents/demo_cli_ui.py

# è¿è¡Œå®é™… agent
uv run src/agents/run_agent_local.py --prompt "æµ‹è¯• CLI UI" --ui rich --verbose
```

### è‡ªåŠ¨åŒ–æµ‹è¯•

å¾…æ·»åŠ å•å…ƒæµ‹è¯•ï¼š
- äº‹ä»¶å¤„ç†å™¨æµ‹è¯•
- æ ¼å¼åŒ–è¾“å‡ºæµ‹è¯•
- ç»Ÿè®¡åŠŸèƒ½æµ‹è¯•

## å…¼å®¹æ€§

- **Python**: 3.12+
- **ç»ˆç«¯**: æ”¯æŒ UTF-8 å’Œ ANSI é¢œè‰²çš„ç»ˆç«¯
- **æ“ä½œç³»ç»Ÿ**: macOS, Linux, Windows (with Windows Terminal)

## æ–‡æ¡£

- ğŸ“„ [CLI UI ä½¿ç”¨æ–‡æ¡£](../src/agents/CLI_UI_README.md)
- ğŸ¯ [æ¼”ç¤ºè„šæœ¬](../src/agents/demo_cli_ui.py)
- ğŸ“‹ [é¡¹ç›®æ–‡æ¡£](../docs/project_description.md)

## è´¡çŒ®è€…

- åˆå§‹å®ç°: 2026-02-01

## ç›¸å…³ Issue/PR

- Feature Request: ç¾åŒ– Agent å‘½ä»¤è¡Œè¾“å‡º
- æå‡å¼€å‘ä½“éªŒå’Œè°ƒè¯•æ•ˆç‡
